---
title: 【MySQL】03 - 表设计原则
date: 2022-10-12
tags: [datebase, MySQL]
categories: [DateBase]
---

## 关系型数据库表设计

项目需求分析完成后，需要对库表进行设计，定义库表的结构：有哪些实体需要抽象成表、表中都有哪些字段、每个字段用什么类型、表与表之间的关系等等。每个表代表一个实体，表与表的关系就是实体与实体的关系，分为下面三类分析（一对一、一对多、多对多）。

### 一对一

示例：用户user和其身份信息info为一对一关系，使用**外键**（逻辑）进行关联。

用户表 user：（主表）

|uid|name|age|sex|
|---|---|---|---|
|1000|zhang|20|m|
|1020|liu|21|f|
|2010|wang|22|f|

身份信息表 info：（子表）

|uid|cardid|address|
|---|---|---|
|1000|112233|aaa|
|1020|334455|bbb|
|2010|667788|ccc|

在info表中（子表），添加了uid外键，关联了父表user主键uid，这样就能将用户和其身份信息对应起来。

> 注意！在实际使用时，我们不会让mysql执行外键的约束逻辑，而是将该逻辑交由业务层代码实现。让mysql专注于核心逻辑的执行（磁盘IO）。


### 一对多

我们以电商平台的例子来分析一对多和多对多的表设计。一共三张表（暂时不正确的），用户表、商品表、订单表。

分析它们之间的关系：  
- 用户-商品：没有关系；
- 用户-订单：一对多关系，一个用户可以有多个订单，一个订单只能对应一个用户；
- 商品-订单：多对多关系，一种商品可以在多个订单种，一个订单可以包含多种商品。


初定的表结构如下：

用户表 user：主键是uid

|uid|name|age|sex|
|---|---|---|---|
|1000|zhang|20|m|
|1020|liu|21|f|
|2010|wang|22|f|

商品表 product：主键是pid

|pid|pname|price|amount|
|---|---|---|---|
|1|手机|600.0|100|
|2|电脑|2000.0|50|
|3|电池|10.0|200|

订单表 order：

|orderid|uid|pid|number|money|totalprice|address|
|---|---|---|---|---|---|---|
|1111|1020|1|1|600.0|4640.0|海淀区|
|1111|1020|2|2|4000.0|4640.0|海淀区|
|1111|1020|3|4|40.0|4640.0|海淀区|
|2222|2010|2|1|2000.0|2000.0|平谷区|


从上面的表设计可以看出，在订单表中添加一列uid（外键），即可实现用户和订单的一对多关联。

> 问题！在order表中存在大量的冗余信息，除了orderid外，同一个订单的uid、totalprice、address都重复了多次，这完全没必要。我们在下一节多对多分析中解决这个问题。


### 多对多

设计订单表时，我们肯定不能使用上一节设计的表，存在很多冗余，我们的方法是，**使用一张中间表**，来保存一个订单中的多种不同商品的信息。

订单表 order：主键是orderid

|orderid|uid|totalprice|address|
|---|---|---|---|
|1111|1020|4640.0|海淀区|
|2222|2010|2000.0|平谷区|

订单内容表 orderlist：主键是orderid和pid

|orderid|pid|number|money|
|---|---|---|---|
|1111|1|1|600.0|
|1111|2|2|4000.0|
|1111|3|4|40.0|
|2222|2|1|2000.0|

从上面的设计可以看到，order表中每个订单只需要存一次uid、totalprice和address。可以使用orderid作为order表的主键，uid是它的外键。

在orderlist表中，我们将orderid和pid共同作为主键，可以保证主键约束。


### 总结

- 一对一、一对多关系，使用外键，子表添加一列父表的主键
- 多对多关系，使用中间表