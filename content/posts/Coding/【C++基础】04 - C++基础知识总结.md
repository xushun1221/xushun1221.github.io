---
title: 【C++基础】04 - C++基础知识总结
date: 2022-08-04
tags: [C++, Linux]
categories: [Coding]
---

本篇总结C++OOP之外的基础知识。

## 形参带默认值的函数
1. 默认参数应该从右向左给出，调用时从左向右给出参数，如未指定某个参数则从此向右的参数使用默认参数；
2. 调用效率问题，使用默认参数时效率高于传入指定变量；
3. 定义和声明处都可以给出函数形参的默认值；
4. 函数形参默认值只能出现一次，无论是否相等，也无论是定义还是声明。

### 形参默认值顺序 & 调用效率

错误写法：  
```C++
int sum(int a = 10, int b) { // 错误语法
    return a + b;
}
int main() {
    int a = 10;
    int b = 20;
    int ret = sum( , b); //错误语法
}
```

正确写法：  
```C++
int sum(int a = 10, int b = 20) {
    return a + b;
}
int main() {
    int a = 10;
    int b = 20;
    int ret = sum(a, b);
    ret = sum(a, 40);
    ret = sum(a);
    ret = sum();
}
```
观察这个正确写法，它们在调用`sum`函数时，使用的汇编指令不相同。

不使用默认参数时，需要从内存中取出变量数据放入寄存器，再将其压栈：  
```C++
int ret = sum(a, b);
/*
    mov eax, dword ptr[ebp-8]   从内存取出20(b)压栈
    push eax
    mov eax, dword ptr[ebp-4]   从内存取出10(a)压栈
    push eax
    call sum
*/
```

使用默认参数时，也需要将参数压栈，但是直接将立即数压栈，无需操作内存（使用常量做参数也是如此）：  
```C++
ret = sum(a, 40);
/*
    push 28h
    mov eax, dword ptr[ebp-4]
    push eax
    call sum
*/
ret = sum(a);
/*
    push 14h
    mov eax, dword ptr[ebp-4]
    push eax
    call sum
*/
ret = sum();
/*
    push 14h
    push 0ah
    call sum
*/
```
从上面的汇编指令可以看出，使用默认参数可以减少读取内存的次数，提高效率。当然提高效率应该不是使用默认参数的主要原因。

### 定义和声明处给出形参默认值

错误写法：  
```C++
int sum(int a = 10, int b = 20, int c = 30); // 声明处给出形参默认值
int main() {
    int a = 10;
    int b = 20;
    int c = 30;
    int ret = sum();
}
int sum(int a = 10, int b = 20, int c = 30) { // 定义处也给出形参默认值
    return a + b + c;
}


// 注意 下面这种写法同样错误 定义出给出了形参默认值 但声明处没有 同样无法使用默认值
int sum(int a, int b, int c);
int main() {
    int a = 10;
    int b = 20;
    int c = 30;
    int ret = sum();
}
int sum(int a = 10, int b = 20, int c = 30) {
    return a + b + c;
}
```

正确写法：  
```C++
int sum(int a, int b, int c); // 不带默认值的声明不会出错
int sum(int a = 10, int b = 20, int c = 30); // 只在声明处给出形参默认值
int main() {
    int a = 10;
    int b = 20;
    int c = 30;
    int ret = sum();
}
int sum(int a, int b, int c) {
    return a + b + c;
}
```

另一种正确写法，编译器编译顺序为从上到下、从右向左，所以下面的写法正确：  
```C++
int sum(int a, int b, int c = 30);
int sum(int a, int b = 20, int c); // 编译到这行 编译器已经知道int c的默认值了
int sum(int a = 10, int b, int c); // 编译到这行 编译器已经知道int c和int b的默认值了
int main() {
    int a = 10;
    int b = 20;
    int c = 30;
    int ret = sum();
}
int sum(int a, int b, int c) {
    return a + b + c;
}

// 这样也行
int sum(int a, int b, int c = 30);
int sum(int a = 10, int b = 20, int c);
/*
...
*/
```

## inline内联函数
