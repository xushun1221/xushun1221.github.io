# 【Linux系统编程】vim的使用


## vim的三种模式
vim有三种模式：
- 命令模式
- 文本模式
- 末行模式

三种模式的切换：
- `vi filename`，使用vim打开文件，文件不存在会创建。此时会进入**命令模式**；
- 在命令模式中使用如下命令可以进入**文本模式**：`i a o I A O s S`，这些键都可，命令模式直接保存退出：`ZZ`（大写）；
- 编辑完文本后，需要切换到**末行模式**保存退出，但是在vim中不可以在文本模式和末行模式中进行切换，需要切换到命令模式，再到末行模式；
- 从文本模式切换到命令模式：`ESC`；
- 从命令模式切换到末行模式：`:`；
- 在末行模式可以执行末行命令：`w`保存，`q`退出；
- 从末行模式切换回命令模式：每次执行完末行命令后都会返回目录模式，或者按两次`ESC`。

使用vim编写代码时，大部分操作都是在命令模式下进行，需要经常在命令模式和文本模式下进行切换。

## 命令模式 - 进入文本模式
进入文本模式的命令和功能：
- `i` 进入编辑模式，光标前插入字符
- `a` 进入编辑模式，光标后插入字符
- `o` 进入编辑模式，光标所在行的下一行插入
- `I` 进入编辑模式，光标所在行的行首插入
- `A` 进入编辑模式，光标所在行的行末插入字符
- `O` 进入编辑模式，光标所在行的上一行插入字符
- `s` 删除光标所在字符并进入编辑模式
- `S` 删除光标所在行并进入编辑模式

## 命令模式 - 光标移动
主键盘按键：
- `h` 左移
- `j` 下移
- `k` 上移
- `l` 右移
- 方向键好像也行

## 命令模式 - 光标跳转
- 跳转到指定行：
  - `222G`，跳转到第222行，缺点是输入没有回显；
  - **末行模式**，`:222`，回车，也可跳转。
- 跳转到首行：`gg`
- 跳转到末行：`G`
- 跳转到行首：`0`数字零
- 跳转到行尾：`$`美元
- 自动格式化程序：`gg=G`
- 当光标指向某个括号时，可以使用`%`跳转到左或右括号

## 命令模式 - 撤销 重做
- 撤销：`u`
- 重做：`ctrl+r`

## 命令模式 - 删除
- 删除光标位置字符：`x`，和`s`的区别是不会进入文本模式 （delete好像也行）
- 删除光标后整个单词：`dw`
- 删除光标到行尾（包括光标位置）：`D`或`d$`
- 删除光标到行首（不包括光标）：`d0`
- 替换光标位置字符：`r`、`要替换的字符`
- 删除选定部分：移动光标到要删除部分开头字符，按`v`进入选择模式，按`hjkl`左上下右选择范围，然后按`d`删除
- 删除光标所在行：`dd`
- 从光标所在行开始，删除n行：`ndd`
- 实际上vim中没有删除，删掉的内容都在剪切板中，可以粘贴

## 命令模式 - 复制粘贴
- 复制选中部分：`v`进入选择模式，选完后再按`y`复制
- 复制光标所在行：`yy`
- 从光标所在行开始，复制n行：`nyy`
- 向光标所在行的下一行粘贴内容（不会覆盖下一行而是插入）：`p`，如果粘贴的内容没有换行符就在光标后粘贴
- 向光标所在行的上一行粘贴内容：`P`，如果没有换行符在光标前粘贴

## 命令模式 - 查找
- 在文档中查找某个单词，命令模式下按`/`后面加上要查找的单词`word`（末行模式），然后回车，光标回定位到第一个出现的位置，然后按`n`可以看下一个位置，循环查找，查找到文件结尾会提示（`N`会看上一个位置）
- 在文档中看到某个单词，光标定位到这个单词的任意位置，按`*`就会查找和它相同的其他位置（向后查找），也是循环查找
- 同上，按`#`会向前查找

## 末行模式 - 替换
- 单行替换，光标指向要替换的行，按下`:`，`s/待替换字符串/新字符串/`，这样从左向右每次替换一个，如果要全部替换在后面加上`g`，`s/待替换字符串/新字符串/g`
- 全局替换，按下`:`，`%s/待替换字符串/新字符串/g`，如果不加`g`就是替换每一行的第一个
- 替换几行：按下`:`，`29,35s/待替换/新字符串/g`，29行到35行

## 末行模式 - 分页
- 上下分页，`:sp`，可以开好多分页
- 左右分页，`:vsp`，上下左右分页可以自由组合
- 将光标切换到另一个页面，`ctrl+ww`
- 退出当前所在的分页：`:q`
- 退出所有分页：`:qall`，会直接退出vim

## 命令模式 - 查看函数man手册
- 光标移到函数名上，`K`，就可以跳转到函数的man文档中，指定章节用`nK`，一般`3K`

## 命令模式 - 查看宏定义
- 移动到宏变量上，`[d`查看宏定义

## 末行模式 - 执行终端命令
- `!`，后面跟终端命令，即可执行

## 配置vim
- `/etc/vim/vimrc`，修改该文件进行配置
- 可以在家目录下创建一个隐藏文件进行配置，`~/.vimrc`，比上一个方法优先级更高
