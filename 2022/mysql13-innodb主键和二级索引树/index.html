<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>【MySQL】13 - InnoDB主键和二级索引树 | XuShun's Blog</title><meta name=viewport content="width=device-width,initial-scale=1"><meta name=robots content="noodp"><meta name=Description content="XuShun的个人博客，记录学习和生活。"><link rel=prev href=https://xushun1221.github.io/2022/mysql10-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/><link rel=next href=https://xushun1221.github.io/2022/mysql12-b%E6%A0%91%E7%B4%A2%E5%BC%95%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/><link rel=canonical href=https://xushun1221.github.io/2022/mysql13-innodb%E4%B8%BB%E9%94%AE%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E6%A0%91/><link rel="shortcut icon" type=image/x-icon href=/favicon.ico><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/site.webmanifest><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><meta name=msapplication-TileColor content="#da532c"><meta name=theme-color content="#ffffff"><meta name=twitter:card content="summary"><meta name=twitter:title content="【MySQL】13 - InnoDB主键和二级索引树"><meta name=twitter:description content="InnoDB存储引擎采用B+索引树，数据和索引存储在同一个文件中（.ibd）。 InnoDB 主键索引 InnoDB的主键索引树，非叶子节点存储索引key，"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","headline":"【MySQL】13 - InnoDB主键和二级索引树","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/xushun1221.github.io\/2022\/mysql13-innodb%E4%B8%BB%E9%94%AE%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E6%A0%91\/"},"image":{"@type":"ImageObject","url":"https:\/\/xushun1221.github.io\/cover.png","width":800,"height":600},"genre":"posts","keywords":"datebase, MySQL","wordcount":1842,"url":"https:\/\/xushun1221.github.io\/2022\/mysql13-innodb%E4%B8%BB%E9%94%AE%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%B4%A2%E5%BC%95%E6%A0%91\/","datePublished":"2022-11-05T00:00:00\x2b00:00","dateModified":"2022-11-05T00:00:00\x2b00:00","license":"This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher":{"@type":"Organization","name":"xushun","logo":{"@type":"ImageObject","url":"https:\/\/xushun1221.github.io\/logo.png","width":127,"height":40}},"description":""}</script><link rel=stylesheet href=/css/style.min.css><link rel=stylesheet href=/css/lib/fontawesome-free/all.min.css></head><body><script>window.isDark=(window.localStorage&&window.localStorage.getItem('theme'))==='dark';window.isDark&&document.body.classList.add('dark-theme');</script><div class=wrapper><nav class=navbar><div class=top-scroll-bar></div><div class=navbar-container><div class="navbar-header animated bounceIn"><a href=https://xushun1221.github.io>XuShun's Blog</a></div><div class=navbar-menu><a class=menu-item href=https://xushun1221.github.io/posts>Posts</a><a class=menu-item href=https://xushun1221.github.io/tags>Tags</a><a class=menu-item href=https://xushun1221.github.io/categories>Categories</a><a class=menu-item href=https://xushun1221.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><nav class=navbar-mobile><div class=top-scroll-bar></div><div class=navbar-container><div class=navbar-header><div class="navbar-header-title animated bounceIn"><a href=https://xushun1221.github.io>XuShun's Blog</a></div><div class=menu-toggle id=menu-toggle><span></span><span></span><span></span></div></div><div class=navbar-menu id=mobile-menu><a class=menu-item href=https://xushun1221.github.io/posts>Posts</a><a class=menu-item href=https://xushun1221.github.io/tags>Tags</a><a class=menu-item href=https://xushun1221.github.io/categories>Categories</a><a class=menu-item href=https://xushun1221.github.io/about>About</a><a href=javascript:void(0); class=theme-switch><i class="fas fa-adjust fa-rotate-180 fa-fw" title="Switch Theme"></i></a></div></div></nav><main class=main><div class=container><article class=page><h1 class="post-title animated flipInX">【MySQL】13 - InnoDB主键和二级索引树</h1><div class=post-meta><i class="far fa-calendar-alt fa-fw"></i>published on&nbsp;<time datetime=2022-11-05>2022-11-05</time>&nbsp;
<i class="fas fa-pencil-alt fa-fw"></i>about 1842 words&nbsp;<span class=post-category><i class="far fa-folder fa-fw"></i>included in&nbsp;<a href=https://xushun1221.github.io/categories/datebase/>Date base</a>&nbsp;</span></div><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class=post-toc-content><nav id=TableOfContents><ul><li><a href=#innodb-主键索引>InnoDB 主键索引</a><ul><li><a href=#分析sql>分析sql</a></li></ul></li><li><a href=#innodb-二级索引辅助索引>InnoDB 二级索引（辅助索引）</a><ul><li><a href=#分析sql-1>分析sql</a></li></ul></li><li><a href=#多列索引联合索引>多列索引（联合索引）</a></li></ul></nav></div></div><div class=post-toc-mobile id=post-toc-mobile><details><summary><div class=post-toc-title><span>Contents</span>
<span><i class="details icon fas fa-angle-down"></i></span></div></summary><div class=post-toc-content><nav id=TableOfContentsMobile><ul><li><a href=#innodb-主键索引>InnoDB 主键索引</a><ul><li><a href=#分析sql>分析sql</a></li></ul></li><li><a href=#innodb-二级索引辅助索引>InnoDB 二级索引（辅助索引）</a><ul><li><a href=#分析sql-1>分析sql</a></li></ul></li><li><a href=#多列索引联合索引>多列索引（联合索引）</a></li></ul></nav></div></details></div><div class=post-content><p>InnoDB存储引擎采用B+索引树，数据和索引存储在同一个文件中（<code>.ibd</code>）。</p><a class=post-dummy-target id=innodb-主键索引></a><h2>InnoDB 主键索引</h2><p>InnoDB的主键索引树，非叶子节点存储索引key，叶子节点存储索引key和对应的数据。</p><p>做等值查询时，从根节点向下查询；<br>做整表搜索或范围查询时，直接从叶子节点链表进行遍历，无需遍历整个B+树结构。</p><p>主键索引树示意图：</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=/post_images/posts/Database/MySQL/InnoDB%e4%b8%bb%e9%94%ae%e7%b4%a2%e5%bc%95%e6%a0%91.jpg alt title=InnoDB主键索引树 class=lazyload><figcaption class=image-caption>InnoDB主键索引树</figcaption></figure></p><blockquote><p>InnoDB的索引树叶节点包含了完整的数据记录，这种索引叫做<strong>聚集索引</strong>。
因为InnoDB的数据文件本身要按主键聚集，所以InnoDB要求表必须有主键（区别于MyISAM可以没有），如果没有显式指定，则MySQL系统会自动选择一个可以唯一标识数据记录的列作为主键，如果不存在这种列，则MySQL自动为InnoDB表生成一个隐含字段作为主键，这个字段长度为6个字节，类型为长整形。</p></blockquote><a class=post-dummy-target id=分析sql></a><h3>分析sql</h3><p>示例：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=n>mysql</span><span class=o>&gt;</span> <span class=k>DROP</span> <span class=k>INDEX</span> <span class=n>nameidx</span> <span class=k>On</span> <span class=n>student</span><span class=p>;</span>
<span class=n>Query</span> <span class=n>OK</span><span class=p>,</span> <span class=mi>0</span> <span class=k>rows</span> <span class=n>affected</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>01</span> <span class=n>sec</span><span class=p>)</span>
<span class=n>Records</span><span class=p>:</span> <span class=mi>0</span>  <span class=n>Duplicates</span><span class=p>:</span> <span class=mi>0</span>  <span class=n>Warnings</span><span class=p>:</span> <span class=mi>0</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>uid</span><span class=o>=</span><span class=mi>5</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span>  <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>     <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=n>const</span> <span class=o>|</span> <span class=k>PRIMARY</span>       <span class=o>|</span> <span class=k>PRIMARY</span> <span class=o>|</span> <span class=mi>4</span>       <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>NULL</span>  <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>01</span> <span class=n>sec</span><span class=p>)</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>uid</span><span class=o>&lt;</span><span class=mi>5</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span>  <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>     <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>       <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=n>range</span> <span class=o>|</span> <span class=k>PRIMARY</span>       <span class=o>|</span> <span class=k>PRIMARY</span> <span class=o>|</span> <span class=mi>4</span>       <span class=o>|</span> <span class=k>NULL</span> <span class=o>|</span>    <span class=mi>4</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>where</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+-------+---------------+---------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;</span><span class=s1>chenwei</span><span class=s1>&#39;</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>  <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>       <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ALL</span>  <span class=o>|</span> <span class=k>NULL</span>          <span class=o>|</span> <span class=k>NULL</span> <span class=o>|</span> <span class=k>NULL</span>    <span class=o>|</span> <span class=k>NULL</span> <span class=o>|</span>    <span class=mi>5</span> <span class=o>|</span>    <span class=mi>20</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>where</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+------+---------+------+------+----------+-------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p><code>type</code>字段的<code>const</code>、<code>range</code>、<code>ALL</code>分别对应等值查询、范围查询和整表扫描。</p><a class=post-dummy-target id=innodb-二级索引辅助索引></a><h2>InnoDB 二级索引（辅助索引）</h2><p>InnoDB的普通索引（二级索引），非叶子节点存储普通索引key（不同于主键，主键不允许重复，普通索引可以重复），叶子节点存储普通索引key和其对应的记录行的主键值。</p><p>使用带二级索引的字段进行过滤时，如果查询的字段仅为主键或二级索引字段，则直接在该二级索引树上搜索即可。</p><p>如果查询的字段不是主键或二级索引对应的字段，则需要<strong>回表</strong>，回表是说，在二级索引树上搜索得到主键，再用主键在主键索引树上搜索其对应的记录行中的其他字段值。</p><p>二级索引树示意图：</p><p><figure><img src=/svg/loading.min.svg data-sizes=auto data-src=/post_images/posts/Database/MySQL/InnoDB%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95%e6%a0%91.jpg alt title=InnoDB二级索引树 class=lazyload><figcaption class=image-caption>InnoDB二级索引树</figcaption></figure></p><a class=post-dummy-target id=分析sql-1></a><h3>分析sql</h3><p>给<code>student</code>表的<code>name</code>字段加上索引：<code>CREATE INDEX nameidx ON student(name);</code></p><p>分析几个sql：</p><ol><li><code>SELECT name FROM student WHERE name='chenwei';</code>
<code>name</code>字段有索引，查询的字段也是<code>name</code>，直接在二级索引树上完成搜索了</li><li><code>SELECT uid,name FROM student WHERE name='chenwei';</code>
<code>uid</code>是主键，存放在二级索引树的叶子节点中，所以也可以直接在二级索引树上完成搜索</li><li><code>SELECT * FROM student WHERE name='chenwei';</code><ol><li>在二级索引树上搜索<code>chenwei</code>对应的主键<code>uid</code></li><li>再用该主键在主键索引树上搜索<code>uid</code>那一行的记录数据</li></ol></li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=n>name</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;</span><span class=s1>chenwei</span><span class=s1>&#39;</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>     <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>       <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=n>nameidx</span>       <span class=o>|</span> <span class=n>nameidx</span> <span class=o>|</span> <span class=mi>152</span>     <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>index</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=n>uid</span><span class=p>,</span><span class=n>name</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;</span><span class=s1>chenwei</span><span class=s1>&#39;</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>     <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>       <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=n>nameidx</span>       <span class=o>|</span> <span class=n>nameidx</span> <span class=o>|</span> <span class=mi>152</span>     <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>index</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>name</span><span class=o>=</span><span class=s1>&#39;</span><span class=s1>chenwei</span><span class=s1>&#39;</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>     <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=n>nameidx</span>       <span class=o>|</span> <span class=n>nameidx</span> <span class=o>|</span> <span class=mi>152</span>     <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>1</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>NULL</span>  <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+---------+---------+-------+------+----------+-------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><blockquote><p>涉及到查询时，尽量避免使用<code>SELECT * ...</code>，最好需要哪些字段就写哪些。</p></blockquote><a class=post-dummy-target id=多列索引联合索引></a><h2>多列索引（联合索引）</h2><p><code>SELECT * FROM student WHERE age=20 ORDER BY name;</code>，如果要进行这样的查询，应该怎么做效率最高呢？</p><p>对同一个表进行搜索，我们不能同时使用两个索引，而应该使用<strong>多列索引（联合索引）</strong>。</p><p><code>age</code>有索引，<code>name</code>无索引，出现了<code>Using filesort</code>，效率很低：</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span><span class=lnt>6
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=c1>----+-------------+---------+------------+------+---------------+--------+---------+-------+------+----------+---------------------------------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>    <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>                                 <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+--------+---------+-------+------+----------+---------------------------------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=n>ageidx</span>        <span class=o>|</span> <span class=n>ageidx</span> <span class=o>|</span> <span class=mi>1</span>       <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>2</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>index</span> <span class=n>condition</span><span class=p>;</span> <span class=k>Using</span> <span class=n>filesort</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+--------+---------+-------+------+----------+---------------------------------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>添加联合索引<code>(age,name)</code>（先按age排序，再按name排序），构建联合索引的时候，已经按照<code>age,name</code>的顺序进行了排序，就不需要再对<code>name</code>进行排序了，自然也就没有<code>Using filesort</code>，效率提高</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span></code></pre></td><td class=lntd><pre class=chroma><code class=language-sql data-lang=sql><span class=n>mysql</span><span class=o>&gt;</span> <span class=k>CREATE</span> <span class=k>INDEX</span> <span class=n>age_name_idx</span> <span class=k>ON</span> <span class=n>student</span><span class=p>(</span><span class=n>age</span><span class=p>,</span><span class=n>name</span><span class=p>)</span><span class=p>;</span>
<span class=n>Query</span> <span class=n>OK</span><span class=p>,</span> <span class=mi>0</span> <span class=k>rows</span> <span class=n>affected</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>01</span> <span class=n>sec</span><span class=p>)</span>
<span class=n>Records</span><span class=p>:</span> <span class=mi>0</span>  <span class=n>Duplicates</span><span class=p>:</span> <span class=mi>0</span>  <span class=n>Warnings</span><span class=p>:</span> <span class=mi>0</span>

<span class=n>mysql</span><span class=o>&gt;</span> <span class=k>EXPLAIN</span> <span class=k>SELECT</span> <span class=o>*</span> <span class=k>FROM</span> <span class=n>student</span> <span class=k>WHERE</span> <span class=n>age</span><span class=o>=</span><span class=mi>20</span> <span class=k>ORDER</span> <span class=k>BY</span> <span class=n>name</span><span class=p>;</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+
</span><span class=c1></span><span class=o>|</span> <span class=n>id</span> <span class=o>|</span> <span class=n>select_type</span> <span class=o>|</span> <span class=k>table</span>   <span class=o>|</span> <span class=n>partitions</span> <span class=o>|</span> <span class=k>type</span> <span class=o>|</span> <span class=n>possible_keys</span> <span class=o>|</span> <span class=k>key</span>          <span class=o>|</span> <span class=n>key_len</span> <span class=o>|</span> <span class=k>ref</span>   <span class=o>|</span> <span class=k>rows</span> <span class=o>|</span> <span class=n>filtered</span> <span class=o>|</span> <span class=n>Extra</span>                 <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+
</span><span class=c1></span><span class=o>|</span>  <span class=mi>1</span> <span class=o>|</span> <span class=k>SIMPLE</span>      <span class=o>|</span> <span class=n>student</span> <span class=o>|</span> <span class=k>NULL</span>       <span class=o>|</span> <span class=k>ref</span>  <span class=o>|</span> <span class=n>age_name_idx</span>  <span class=o>|</span> <span class=n>age_name_idx</span> <span class=o>|</span> <span class=mi>1</span>       <span class=o>|</span> <span class=n>const</span> <span class=o>|</span>    <span class=mi>2</span> <span class=o>|</span>   <span class=mi>100</span><span class=p>.</span><span class=mi>00</span> <span class=o>|</span> <span class=k>Using</span> <span class=k>index</span> <span class=n>condition</span> <span class=o>|</span>
<span class=o>+</span><span class=c1>----+-------------+---------+------------+------+---------------+--------------+---------+-------+------+----------+-----------------------+
</span><span class=c1></span><span class=mi>1</span> <span class=k>row</span> <span class=k>in</span> <span class=k>set</span><span class=p>,</span> <span class=mi>1</span> <span class=n>warning</span> <span class=p>(</span><span class=mi>0</span><span class=p>.</span><span class=mi>00</span> <span class=n>sec</span><span class=p>)</span>
</code></pre></td></tr></table></div></div><p>当然了，这个sql也需要回表，因为这个二级索引树上只有<code>age</code>、<code>name</code>、<code>uid</code>三列。</p><blockquote><p>注意，使用多列索引，必须使用多列索引的第一个索引，因为多列索引的第一个索引列是最优先进行排序的。</p></blockquote></div><div class=post-copyright id=post-footer><p class=copyright-item><span>Author:&nbsp;</span>
<span>xushun</span></p><p class=copyright-item><span>Updated on:&nbsp;</span>
<span>2022-11-05</span></p><p class=copyright-item><span>Share on:&nbsp;</span>
<span><a href="//twitter.com/share?url=https%3a%2f%2fxushun1221.github.io%2f2022%2fmysql13-innodb%25E4%25B8%25BB%25E9%2594%25AE%25E5%2592%258C%25E4%25BA%258C%25E7%25BA%25A7%25E7%25B4%25A2%25E5%25BC%2595%25E6%25A0%2591%2f&text=%e3%80%90MySQL%e3%80%9113%20-%20InnoDB%e4%b8%bb%e9%94%ae%e5%92%8c%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95%e6%a0%91&via=" target=_blank title="Share on Twitter"><i class="fab fa-twitter fa-fw"></i></a><a href="//www.facebook.com/sharer/sharer.php?u=https%3a%2f%2fxushun1221.github.io%2f2022%2fmysql13-innodb%25E4%25B8%25BB%25E9%2594%25AE%25E5%2592%258C%25E4%25BA%258C%25E7%25BA%25A7%25E7%25B4%25A2%25E5%25BC%2595%25E6%25A0%2591%2f" target=_blank title="Share on Facebook"><i class="fab fa-facebook-square fa-fw"></i></a><a href="//reddit.com/submit?url=https%3a%2f%2fxushun1221.github.io%2f2022%2fmysql13-innodb%25E4%25B8%25BB%25E9%2594%25AE%25E5%2592%258C%25E4%25BA%258C%25E7%25BA%25A7%25E7%25B4%25A2%25E5%25BC%2595%25E6%25A0%2591%2f&title=%e3%80%90MySQL%e3%80%9113%20-%20InnoDB%e4%b8%bb%e9%94%ae%e5%92%8c%e4%ba%8c%e7%ba%a7%e7%b4%a2%e5%bc%95%e6%a0%91" target=_blank title="Share on Reddit"><i class="fab fa-reddit fa-fw"></i></a></span></p><p class=copyright-item></p><p class=copyright-item></p></div><br><div class=post-info-more><section><span class=tag><a href=https://xushun1221.github.io/tags/datebase/><i class="fas fa-tag fa-fw"></i>&nbsp;datebase</a>&nbsp;
</span><span class=tag><a href=https://xushun1221.github.io/tags/mysql/><i class="fas fa-tag fa-fw"></i>&nbsp;MySQL</a>&nbsp;</span></section><section><span><a href=javascript:window.history.back();>Back</a></span>&nbsp;|&nbsp;<span><a href=https://xushun1221.github.io>Home</a></span></section></div><div class=post-nav><a href=https://xushun1221.github.io/2022/mysql10-%E5%AD%98%E5%82%A8%E5%BC%95%E6%93%8E/ class=prev rel=prev title="【MySQL】10 - 存储引擎"><i class="fas fa-angle-left fa-fw"></i>【MySQL】10 - 存储引擎</a>
<a href=https://xushun1221.github.io/2022/mysql12-b%E6%A0%91%E7%B4%A2%E5%BC%95%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86/ class=next rel=next title="【MySQL】12 - B树索引：索引的底层原理">【MySQL】12 - B树索引：索引的底层原理<i class="fas fa-angle-right fa-fw"></i></a></div><div class=post-comment></div></article></div></main><footer class=footer><div class=copyright><div class=copyright-line><i class="far fa-copyright fa-fw"></i><span itemprop=copyrightYear>2022 - 2024</span><span class=author itemprop=copyrightHolder>&nbsp;<a href=https://xushun1221.github.io/about/ target=_blank>xushun</a> | </span>Powered by <a href=https://gohugo.io/ target=_blank rel="external nofollow noopener noreffer">Hugo</a> & <a href=https://github.com/dillonzq/LoveIt target=_blank rel="external nofollow noopener noreffer">LoveIt</a></div></div></footer></div><a href=# class=dynamic-to-top id=dynamic-to-top data-scroll><span>&nbsp;</span>
</a><script src=/js/lib/jquery/jquery.slim.min.js></script><script src=/js/lib/lazysizes/lazysizes.min.js></script><script src=/js/lib/smooth-scroll/smooth-scroll.polyfills.min.js></script><script>window.scroll=new SmoothScroll('[data-scroll]',{speed:300,speedAsDuration:true});</script><link rel=stylesheet href=/css/lib/katex/katex.min.css><script src=/js/lib/katex/katex.min.js></script><script defer src=/js/lib/katex/auto-render.min.js></script><link rel=stylesheet href=/css/lib/katex/copy-tex.min.css><script defer src=/js/lib/katex/copy-tex.min.js></script><script defer src=/js/lib/katex/mhchem.min.js></script><script>document.addEventListener("DOMContentLoaded",function(){renderMathInElement(document.body,{delimiters:[{left:"$$",right:"$$",display:true},{left:"\\(",right:"\\)",display:false},{left:"\\[",right:"\\]",display:true},{left:"$",right:"$",display:false},]});});</script><script src=/js/blog.min.js></script></body></html>